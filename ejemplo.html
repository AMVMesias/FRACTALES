<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador de Fractales - Zoom Infinito</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: 'Courier New', monospace;
            color: #00ff00;
            overflow: hidden;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #canvas {
            display: block;
            cursor: crosshair;
        }
        
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #00ff00;
            z-index: 100;
        }
        
        #info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #00ff00;
            font-size: 12px;
        }
        
        button {
            background: #001100;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        
        button:hover {
            background: #002200;
        }
        
        input[type="range"] {
            width: 150px;
            margin: 5px;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #00ff00;
            z-index: 200;
        }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        
        <div id="controls">
            <h3>üåÄ Explorador de Fractales</h3>
            <div>
                <label>Iteraciones: <span id="iterValue">100</span></label><br>
                <input type="range" id="iterations" min="50" max="500" value="100">
            </div>
            <div>
                <button onclick="resetView()">üè† Reset</button>
                <button onclick="toggleAutoZoom()">üîÑ Auto Zoom</button>
            </div>
            <div>
                <button onclick="changeColorScheme()">üé® Colores</button>
                <button onclick="saveImage()">üì∑ Guardar</button>
            </div>
        </div>
        
        <div id="info">
            <div>Zoom: <span id="zoomLevel">1x</span></div>
            <div>Posici√≥n: (<span id="posX">0</span>, <span id="posY">0</span>)</div>
            <div>Haz clic para hacer zoom | Rueda del mouse para zoom r√°pido</div>
            <div>Mant√©n Shift + clic para zoom out</div>
        </div>
        
        <div id="loading" class="loading" style="display: none;">Generando fractal...</div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const loadingDiv = document.getElementById('loading');
        
        // Variables del fractal
        let width, height;
        let centerX = -0.5, centerY = 0;
        let zoom = 1;
        let maxIterations = 100;
        let colorScheme = 0;
        let autoZoomActive = false;
        let autoZoomInterval;
        
        // Esquemas de color
        const colorSchemes = [
            // Cl√°sico verde-azul
            (iter, max) => {
                if (iter === max) return [0, 0, 0];
                const t = iter / max;
                return [
                    Math.floor(t * 255),
                    Math.floor(Math.sin(t * Math.PI) * 255),
                    Math.floor((1-t) * 255)
                ];
            },
            // Fuego
            (iter, max) => {
                if (iter === max) return [0, 0, 0];
                const t = iter / max;
                return [
                    Math.floor(255 * Math.min(1, t * 2)),
                    Math.floor(255 * Math.max(0, t * 2 - 1)),
                    Math.floor(255 * Math.max(0, t * 3 - 2))
                ];
            },
            // Oce√°nico
            (iter, max) => {
                if (iter === max) return [0, 0, 0];
                const t = iter / max;
                return [
                    Math.floor(20 + t * 100),
                    Math.floor(50 + t * 150),
                    Math.floor(100 + t * 155)
                ];
            },
            // Psicod√©lico
            (iter, max) => {
                if (iter === max) return [0, 0, 0];
                const t = iter / max * 6;
                return [
                    Math.floor(128 + 127 * Math.sin(t)),
                    Math.floor(128 + 127 * Math.sin(t + 2)),
                    Math.floor(128 + 127 * Math.sin(t + 4))
                ];
            }
        ];
        
        function initCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            drawFractal();
        }
        
        function mandelbrot(x, y) {
            let real = x;
            let imag = y;
            let iterations = 0;
            
            while (iterations < maxIterations) {
                const realSq = real * real;
                const imagSq = imag * imag;
                
                if (realSq + imagSq > 4) break;
                
                const newReal = realSq - imagSq + x;
                imag = 2 * real * imag + y;
                real = newReal;
                iterations++;
            }
            
            return iterations;
        }
        
        function drawFractal() {
            loadingDiv.style.display = 'block';
            
            // Usar setTimeout para no bloquear la UI
            setTimeout(() => {
                const imageData = ctx.createImageData(width, height);
                const data = imageData.data;
                
                const scale = 4 / zoom;
                const offsetX = centerX - scale / 2;
                const offsetY = centerY - scale / 2;
                
                for (let py = 0; py < height; py++) {
                    for (let px = 0; px < width; px++) {
                        const x = offsetX + (px / width) * scale;
                        const y = offsetY + (py / height) * scale;
                        
                        const iterations = mandelbrot(x, y);
                        const [r, g, b] = colorSchemes[colorScheme](iterations, maxIterations);
                        
                        const index = (py * width + px) * 4;
                        data[index] = r;     // Red
                        data[index + 1] = g; // Green
                        data[index + 2] = b; // Blue
                        data[index + 3] = 255; // Alpha
                    }
                }
                
                ctx.putImageData(imageData, 0, 0);
                updateInfo();
                loadingDiv.style.display = 'none';
            }, 10);
        }
        
        function updateInfo() {
            document.getElementById('zoomLevel').textContent = zoom.toExponential(2) + 'x';
            document.getElementById('posX').textContent = centerX.toFixed(10);
            document.getElementById('posY').textContent = centerY.toFixed(10);
        }
        
        function screenToComplex(screenX, screenY) {
            const scale = 4 / zoom;
            const x = centerX - scale / 2 + (screenX / width) * scale;
            const y = centerY - scale / 2 + (screenY / height) * scale;
            return [x, y];
        }
        
        // Event listeners
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const [newCenterX, newCenterY] = screenToComplex(x, y);
            centerX = newCenterX;
            centerY = newCenterY;
            
            if (e.shiftKey) {
                zoom /= 2; // Zoom out
            } else {
                zoom *= 2; // Zoom in
            }
            
            drawFractal();
        });
        
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const [newCenterX, newCenterY] = screenToComplex(x, y);
            centerX = newCenterX;
            centerY = newCenterY;
            
            if (e.deltaY < 0) {
                zoom *= 1.5; // Zoom in
            } else {
                zoom /= 1.5; // Zoom out
            }
            
            drawFractal();
        });
        
        document.getElementById('iterations').addEventListener('input', (e) => {
            maxIterations = parseInt(e.target.value);
            document.getElementById('iterValue').textContent = maxIterations;
            drawFractal();
        });
        
        function resetView() {
            centerX = -0.5;
            centerY = 0;
            zoom = 1;
            drawFractal();
        }
        
        function toggleAutoZoom() {
            if (autoZoomActive) {
                clearInterval(autoZoomInterval);
                autoZoomActive = false;
            } else {
                autoZoomActive = true;
                autoZoomInterval = setInterval(() => {
                    zoom *= 1.1;
                    drawFractal();
                }, 200);
            }
        }
        
        function changeColorScheme() {
            colorScheme = (colorScheme + 1) % colorSchemes.length;
            drawFractal();
        }
        
        function saveImage() {
            const link = document.createElement('a');
            link.download = `fractal_zoom_${zoom.toExponential(2)}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }
        
        // Teclado para navegaci√≥n
        document.addEventListener('keydown', (e) => {
            const step = 0.1 / zoom;
            switch(e.key) {
                case 'ArrowUp': centerY -= step; drawFractal(); break;
                case 'ArrowDown': centerY += step; drawFractal(); break;
                case 'ArrowLeft': centerX -= step; drawFractal(); break;
                case 'ArrowRight': centerX += step; drawFractal(); break;
                case '+': zoom *= 1.5; drawFractal(); break;
                case '-': zoom /= 1.5; drawFractal(); break;
                case 'r': resetView(); break;
                case 'c': changeColorScheme(); break;
            }
        });
        
        window.addEventListener('resize', () => {
            initCanvas();
        });
        
        // Inicializar
        initCanvas();
    </script>
</body>